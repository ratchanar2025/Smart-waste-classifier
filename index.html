<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Waste Segregator AI</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; background: #050505; color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; }
        #dashboard { display: flex; position: absolute; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
        .panel { flex: 1; padding: 40px; pointer-events: auto; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.1); }
        #video-feed { width: 100%; max-width: 400px; border-radius: 15px; border: 2px solid #00f2fe; transform: scaleX(-1); }
        .status-card { font-size: 2.5rem; color: #00f2fe; text-shadow: 0 0 10px #00f2fe; margin-top: 20px; }
        button { padding: 15px 30px; background: #00f2fe; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 20px; }
        canvas#chartCanvas { max-height: 300px; }
    </style>
</head>
<body>
    <div id="dashboard">
        <div class="panel">
            <h1>RE-CYCLE AI</h1>
            <button onclick="startAI()">INITIALIZE SENSORS</button>
            <div id="camera-container"></div>
            <div class="status-card" id="result-label">Awaiting Input...</div>
        </div>
        <div class="panel">
            <h3>Efficiency Scatter Plot (Real-time)</h3>
            <canvas id="chartCanvas"></canvas>
            <p>Scanning for: <b>Plastic, Paper, Metal</b></p>
        </div>
    </div>

    <script>
        // --- 1. 3D BACKGROUND (Three.js) ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
        const material = new THREE.MeshBasicMaterial({ color: 0x00f2fe, wireframe: true });
        const object = new THREE.Mesh(geometry, material);
        scene.add(object);
        camera.position.z = 50;

        function animate() {
            requestAnimationFrame(animate);
            object.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();

        // --- 2. CHARTING (Chart.js) ---
        const ctx = document.getElementById('chartCanvas').getContext('2d');
        const scatterChart = new Chart(ctx, {
            type: 'scatter',
            data: { datasets: [{ label: 'Detection Accuracy', data: [], backgroundColor: '#00f2fe' }] },
            options: { scales: { x: { display: false }, y: { beginAtZero: true, max: 100 } } }
        });

        // --- 3. VISION (TensorFlow.js) ---
        // USING A PUBLIC WASTE MODEL FOR DEMO PURPOSES
        const MODEL_URL = "https://teachablemachine.withgoogle.com/models/v_9L6m7v-/"; 
        let model, webcam, labelContainer, maxPredictions;

        async function startAI() {
            document.querySelector('button').innerText = "SYSTEM ACTIVE";
            model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
            webcam = new tmImage.Webcam(400, 400, true);
            await webcam.setup();
            await webcam.play();
            document.getElementById("camera-container").appendChild(webcam.canvas);
            webcam.canvas.id = "video-feed";
            window.requestAnimationFrame(loop);
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            prediction.sort((a, b) => b.probability - a.probability);
            
            const result = prediction[0];
            document.getElementById("result-label").innerText = result.className.toUpperCase();

            // Update Scatter Plot with dynamic data
            if(scatterChart.data.datasets[0].data.length > 20) scatterChart.data.datasets[0].data.shift();
            scatterChart.data.datasets[0].data.push({ x: Date.now(), y: (result.probability * 100) });
            scatterChart.update('none');
        }
    </script>
</body>
</html>